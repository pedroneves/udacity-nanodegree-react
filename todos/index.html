<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Udacity ToDo App</title>
</head>
<body>
	<div>
		<h1>ToDo List</h1>
		<input id="todo" type="text" placeholder="Add todo" />
		<button id="todoBtn">Add ToDo</button>
		<ul id="todos"></ul>
	</div>
	<div>
		<h1>Goal List</h1>
		<input id="goal" type="text" placeholder="Add goal" />
		<button id="goalBtn">Add goal</button>
		<ul id="goals"></ul>
	</div>

	<script>
		// Source: https://github.com/pedroneves/store
		function createStore (reducer=((state) => state)) {
			let state = {};
			let listeners = [];

			const store = {}

			store.getState = function getState () {
				return state
			}

			store.subscribe = function subscribe(fn) {
				listeners.push(fn);
				return () => {
					listeners = listeners.filter(listener => listener !== fn)
				}
			}

			store.dispatch = function dispatch (action) {
				state = reducer(state, action);
				listeners.forEach(listener => listener())
			}

			return store
		}

		// Action types
		const ADD_TODO = 'ADD_TODO'
		const REMOVE_TODO = 'REMOVE_TODO'
		const TOGGLE_TODO = 'TOGGLE_TODO'
		const ADD_GOAL = 'ADD_GOAL'
		const REMOVE_GOAL = 'REMOVE_GOAL'

		// Action Creators
		function addToDoAction (todo) {
			return { type: ADD_TODO, todo }
		}

		function removeToDoAction (id) {
			return { type: REMOVE_TODO, id }
		}

		function toggleToDoAction (id) {
			return { type: TOGGLE_TODO, id }
		}

		function addGoalAction (goal) {
			return { type: ADD_GOAL, goal }
		}

		function removeGoalAction (id) {
			return { type: REMOVE_GOAL, id }
		}

		// Reducers
		function todos (todos=[], action) {
			switch (action.type) {
				case ADD_TODO:
					return todos.concat([action.todo])
				case REMOVE_TODO:
					return todos.filter(todo => todo.id !== action.id)
				case TOGGLE_TODO:
					return todo.map(todo => {
						if (todo.id === action.id) {
							todo.isDone = !todo.isDone
						}

						return todo
					})
				default:
					return todos
			}
		}

		function goals (goals=[], action) {
			switch (action.type) {
				case ADD_GOAL:
					return goals.concat([action.goal])
				case REMOVE_GOAL:
					return goals.filter(goal => goal.id !== action.id)
				default:
					return goals
			}
		}

		function rootReducer (state={}, action) {
			return {
				goals: goals(state.goals, action),
				todos: todos(state.todos, action)
			}
		}
	</script>
</body>
</html>